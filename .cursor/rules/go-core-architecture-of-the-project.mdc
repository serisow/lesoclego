---
description: 
globs: 
alwaysApply: true
---

# Code Architecture Analysis

## Core Project Idea

This codebase implements a flexible pipeline execution system for automating content generation workflows. It's written in Go and follows a modular architecture that enables various content processing steps including LLM interactions, search operations, social media posting, and multimedia generation. The system works with multiple AI services (OpenAI, Anthropic, Gemini) and can execute both Go-side and Drupal-side actions. The pipeline orchestrates different steps with proper data passing between them, making it suitable for automating complex content workflows.

## Essential Files

@app/pipeline_type/type.go - Defines the core data structures for the pipeline including Pipeline, PipelineStep, Context, and various configurations. This is the foundation that all pipeline components use.

@app/pipeline/pipeline.go - Implements the pipeline execution logic, handling step initialization, execution, error handling, and result reporting.

@app/plugin_registry/plugin_registry.go - Manages the registration and retrieval of pipeline components (steps, LLM services, action services), enabling a modular, plugin-based architecture.

@app/llm_step/llm_step.go - Implements the LLM step logic, which handles interactions with language models by processing prompts and storing responses.

@app/action_step/action_step.go - Implements the action step logic, which either prepares data for Drupal-side actions or executes Go-side actions directly.

@app/services/llm_service/llm_service.go - Defines the interface for LLM services, establishing a standard contract that specific implementations must follow.

@app/services/action_service/action_service.go - Defines the interface for action services that handle various tasks like social media posting or data processing.

@app/services/llm_service/openai.go - Implements the OpenAI service, handling API calls to OpenAI models with error handling and retries.

@app/services/llm_service/anthropic.go - Implements the Anthropic service for Claude model interactions with proper error handling.

@app/services/llm_service/gemini.go - Implements the Gemini service integration for Google's AI models, including image generation capabilities.

@app/social_media_step/social_media_step.go - Implements a specialized pipeline step for generating social media content across multiple platforms.

@app/search_step/google_search_step.go - Implements Google Custom Search integration for retrieving and processing web search results.

@app/search_step/news_api_search_step.go - Implements News API integration for retrieving and processing news articles.

@app/scheduler/scheduler.go - Manages pipeline scheduling, periodically checking for pipelines that need execution based on configured schedules.

@app/pipeline/execution_store.go - Handles storage and cleanup of pipeline execution results to track status and provide execution history.

@app/video/service.go - Implements video generation service using images, audio, and text overlays for creating dynamic content.

@app/server/server.go - Sets up the HTTP server with routes for on-demand pipeline execution and file serving.

@app/main.go - Entry point that initializes all components, registers plugins, and starts the server and scheduler processes.

@app/config/config.go - Loads and provides configuration settings from environment variables, making them available throughout the application.

@app/video/text_overlay.go - Processes text overlay annotations for video content with rich styling and animation options.

@app/video/ffmpeg.go - Interfaces with FFmpeg to generate videos from images and audio with transitions and effects.

@app/upload_step/upload_image_step.go - Handles image upload operations, downloading images from URLs and storing them locally.

@app/upload_step/upload_audio_step.go - Handles audio upload operations, downloading audio files from URLs and storing them locally.

@app/services/action_service/news_item_image_generator_action.go - Implements specialized actions for generating images for news content.